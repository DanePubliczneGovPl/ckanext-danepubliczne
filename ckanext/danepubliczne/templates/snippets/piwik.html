{#
CKANExt-Etalab -- CKAN extension for Etalab
By: Emmanuel Raviart <emmanuel@raviart.com>

Copyright (C) 2013 Etalab
http://github.com/etalab/ckanext-etalab

This file is part of CKANExt-Etalab.

CKANExt-Etalab is free software; you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

CKANExt-Etalab is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
#}

<!-- Piwik -->{% if piwik.error %}<!-- {{ piwik.error }} -->{% else %}
  <script type="text/javascript">
    var _paq = _paq || [];
    {%- if piwik.domain %}
      _paq.push(["setCookieDomain", "*.{{ piwik.domain }}"]);
      _paq.push(["setDomains", "*.{{ piwik.domain }}"]);
    {% endif -%}
    {%- if piwik.cookies_disabled %}
      _paq.push(['disableCookies']);
    {% endif -%}

    _paq.push(["trackPageView"]);
    _paq.push(["enableLinkTracking"]);
    (function () {
      var u = "{{ piwik.url }}/";
      _paq.push(["setTrackerUrl", u + "piwik.php"]);
      _paq.push(["setSiteId", "{{ piwik.site_id }}"]);
      var d = document, g = d.createElement("script"), s = d.getElementsByTagName("script")[0];
      g.type = "text/javascript";
      g.defer = true;
      g.async = true;
      g.src = u + "piwik.js";
      s.parentNode.insertBefore(g, s);
    })();
  </script>
  <noscript><p><img src="{{ piwik.url }}/piwik.php?idsite={{ piwik.site_id }}&rec=1&url={{ request.url }}"
                    style="border:0" alt=""/></p></noscript>
{% endif %}<!-- End Piwik Code -->

{% if googleanalytics_id %}
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', '{{ googleanalytics_id }}', 'auto');
  ga('send', 'pageview');
</script>
{% endif %}